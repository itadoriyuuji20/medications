<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Manajemen Obat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
        .transition-all {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // State Management
        let state = {
            currentUser: null,
            currentPage: 'login',
            selectedPatient: null,
            showAlert: false,
            alertType: '',
            sidebarOpen: true,
            loginError: '',
            loginForm: {
                userId: '',
                password: ''
            },
            formData: {
                medication: '',
                dose: '',
                frequency: '',
                route: 'Oral'
            }
        };

        // Mock Data - User credentials
        const users = {
            doctor: { 
                id: 1, 
                name: 'Dr. Ahmad Wijaya', 
                role: 'Dokter', 
                email: 'ahmad.wijaya@hospital.com',
                userId: 'doctor001',
                password: 'doctor123'
            },
            nurse: { 
                id: 2, 
                name: 'Ns. Siti Nurhaliza', 
                role: 'Perawat', 
                email: 'siti.nurhaliza@hospital.com',
                userId: 'nurse001',
                password: 'nurse123'
            },
            admin: { 
                id: 3, 
                name: 'Admin Sistem', 
                role: 'Administrator', 
                email: 'admin@hospital.com',
                userId: 'admin001',
                password: 'admin123'
            }
        };

        const patients = [
            { 
                id: 'P001', 
                name: 'Budi Santoso', 
                age: 45, 
                mrn: 'MRN-2024-001',
                allergies: ['Penisilin', 'Aspirin'],
                conditions: ['Hipertensi', 'Diabetes Tipe 2'],
                activeMedications: [
                    { id: 1, name: 'Metformin', dose: '500mg', frequency: '2x sehari', route: 'Oral', prescribedBy: 'Dr. Ahmad', date: '2024-01-15' },
                    { id: 2, name: 'Amlodipine', dose: '5mg', frequency: '1x sehari', route: 'Oral', prescribedBy: 'Dr. Ahmad', date: '2024-01-15' }
                ]
            },
            { 
                id: 'P002', 
                name: 'Rina Permata', 
                age: 32, 
                mrn: 'MRN-2024-002',
                allergies: ['Tidak ada'],
                conditions: ['Asma'],
                activeMedications: [
                    { id: 3, name: 'Salbutamol Inhaler', dose: '100mcg', frequency: 'Sesuai kebutuhan', route: 'Inhalasi', prescribedBy: 'Dr. Ahmad', date: '2024-01-20' }
                ]
            }
        ];

        const auditLogs = [
            { id: 1, user: 'Dr. Ahmad Wijaya', action: 'Membuat resep baru', detail: 'Metformin 500mg untuk P001', timestamp: '2024-01-31 09:15:23' },
            { id: 2, user: 'Ns. Siti Nurhaliza', action: 'Melihat data pasien', detail: 'Akses data P001', timestamp: '2024-01-31 09:30:45' },
            { id: 3, user: 'Dr. Ahmad Wijaya', action: 'Mengubah resep', detail: 'Update dosis Amlodipine untuk P001', timestamp: '2024-01-31 10:05:12' },
            { id: 4, user: 'Admin Sistem', action: 'Membuat user baru', detail: 'Ns. Maria ditambahkan', timestamp: '2024-01-31 08:00:00' }
        ];

        // Helper Functions
        function handleLogin(e) {
            e.preventDefault();
            const { userId, password } = state.loginForm;
            
            // Reset error
            state.loginError = '';
            
            // Check credentials
            let validUser = null;
            for (let userType in users) {
                if (users[userType].userId === userId && users[userType].password === password) {
                    validUser = users[userType];
                    break;
                }
            }
            
            if (validUser) {
                state.currentUser = validUser;
                state.currentPage = 'dashboard';
                state.loginForm = { userId: '', password: '' }; // Reset form
            } else {
                state.loginError = 'User ID atau Password salah!';
            }
            
            render();
        }

        function updateLoginForm(field, value) {
            state.loginForm[field] = value;
        }

        function handleLogout() {
            state.currentUser = null;
            state.currentPage = 'login';
            state.selectedPatient = null;
            render();
        }

        function setPage(page) {
            state.currentPage = page;
            render();
        }

        function selectPatient(patientId) {
            state.selectedPatient = patients.find(p => p.id === patientId);
            state.currentPage = 'patient-detail';
            render();
        }

        function toggleSidebar() {
            state.sidebarOpen = !state.sidebarOpen;
            render();
        }

        function checkDrugInteraction(newDrug) {
            const interactions = {
                'Warfarin': { interactsWith: ['Aspirin', 'Ibuprofen'], risk: 'Tinggi - Risiko perdarahan' },
                'Metformin': { interactsWith: ['Metformin'], risk: 'Duplikasi obat terdeteksi' },
                'Amoxicillin': { interactsWith: ['Penisilin'], risk: 'Tinggi - Alergi terdeteksi' }
            };

            if (interactions[newDrug]) {
                state.alertType = interactions[newDrug].risk;
                state.showAlert = true;
                return true;
            }
            return false;
        }

        function handlePrescriptionSubmit(e) {
            e.preventDefault();
            const { medication, dose, frequency, route } = state.formData;
            
            if (checkDrugInteraction(medication)) {
                setTimeout(() => {
                    state.showAlert = false;
                    render();
                }, 3000);
            } else {
                alert('Resep berhasil disimpan!');
                state.currentPage = 'patient-detail';
            }
            render();
        }

        function updateFormData(field, value) {
            state.formData[field] = value;
        }

        // SVG Icons
        const icons = {
            home: '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>',
            users: '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>',
            fileText: '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>',
            activity: '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>',
            shield: '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>',
            menu: '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>',
            x: '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>',
            plus: '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>',
            eye: '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>',
            check: '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>',
            alertTriangle: '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>',
            pill: '<svg width="32" height="32" fill="currentColor" viewBox="0 0 24 24"><path d="M4.22 11.29l6.36-6.36c1.95-1.95 5.12-1.95 7.07 0l.71.71c1.95 1.95 1.95 5.12 0 7.07l-6.36 6.36c-1.95 1.95-5.12 1.95-7.07 0l-.71-.71c-1.95-1.95-1.95-5.12 0-7.07zm12.02-.71L10.59 4.93c-1.17-1.17-3.07-1.17-4.24 0l-.71.71c-1.17 1.17-1.17 3.07 0 4.24l5.66 5.66 5.66-5.66c1.17-1.17 1.17-3.07 0 4.24l-.71-.71c-.59-.59-1.37-.88-2.12-.88s-1.54.29-2.12.88z"/><path d="M15.5 10.5L9 17"/></svg>',
            user: '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>'
        };

        // Render Functions
        function renderLoginPage() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
                        <div class="text-center mb-8">
                            <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                <div class="text-white">${icons.pill}</div>
                            </div>
                            <h1 class="text-2xl font-bold text-gray-800">Sistem Manajemen Obat</h1>
                            <p class="text-gray-600 mt-2">Medication Management & Patient Safety System</p>
                        </div>

                        ${state.loginError ? `
                            <div class="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                                <p class="text-red-700 text-sm text-center">${state.loginError}</p>
                            </div>
                        ` : ''}

                        <form onsubmit="handleLogin(event)" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">User ID</label>
                                <input 
                                    type="text" 
                                    value="${state.loginForm.userId}"
                                    oninput="updateLoginForm('userId', this.value)"
                                    placeholder="Masukkan User ID"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    required
                                />
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input 
                                    type="password"
                                    value="${state.loginForm.password}"
                                    oninput="updateLoginForm('password', this.value)"
                                    placeholder="Masukkan Password"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    required
                                />
                            </div>

                            <button 
                                type="submit"
                                class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition font-medium"
                            >
                                Login
                            </button>
                        </form>

                        <div class="mt-6 pt-6 border-t border-gray-200">
                            <div class="bg-gray-50 rounded-lg p-3">
                                <p class="text-xs font-semibold text-gray-700 mb-2">Akun Demo:</p>
                                <div class="space-y-1 text-xs text-gray-600">
                                    <p><strong>Dokter:</strong> doctor001 / doctor123</p>
                                    <p><strong>Perawat:</strong> nurse001 / nurse123</p>
                                    <p><strong>Admin:</strong> admin001 / admin123</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSidebar() {
            const { currentUser, sidebarOpen, currentPage } = state;
            
            return `
                <div class="${sidebarOpen ? 'w-64' : 'w-20'} bg-gray-900 text-white transition-all duration-300 flex flex-col">
                    <div class="p-4 flex items-center justify-between border-b border-gray-700">
                        ${sidebarOpen ? '<span class="font-bold text-lg">MedSafe System</span>' : ''}
                        <button onclick="toggleSidebar()" class="p-2 hover:bg-gray-800 rounded">
                            ${sidebarOpen ? icons.x : icons.menu}
                        </button>
                    </div>

                    <nav class="flex-1 p-4 space-y-2">
                        <button onclick="setPage('dashboard')" class="w-full flex items-center gap-3 p-3 rounded transition ${currentPage === 'dashboard' ? 'bg-blue-600' : 'hover:bg-gray-800'}">
                            ${icons.home}
                            ${sidebarOpen ? '<span>Dashboard</span>' : ''}
                        </button>
                        
                        <button onclick="setPage('patients')" class="w-full flex items-center gap-3 p-3 rounded transition ${currentPage === 'patients' ? 'bg-blue-600' : 'hover:bg-gray-800'}">
                            ${icons.users}
                            ${sidebarOpen ? '<span>Data Pasien</span>' : ''}
                        </button>
                        
                        ${currentUser?.role === 'Dokter' ? `
                            <button onclick="setPage('prescriptions')" class="w-full flex items-center gap-3 p-3 rounded transition ${currentPage === 'prescriptions' ? 'bg-blue-600' : 'hover:bg-gray-800'}">
                                ${icons.fileText}
                                ${sidebarOpen ? '<span>Resep Obat</span>' : ''}
                            </button>
                        ` : ''}
                        
                        ${currentUser?.role === 'Perawat' ? `
                            <button onclick="setPage('administration')" class="w-full flex items-center gap-3 p-3 rounded transition ${currentPage === 'administration' ? 'bg-blue-600' : 'hover:bg-gray-800'}">
                                ${icons.activity}
                                ${sidebarOpen ? '<span>Pemberian Obat</span>' : ''}
                            </button>
                        ` : ''}
                        
                        ${currentUser?.role === 'Administrator' ? `
                            <button onclick="setPage('audit')" class="w-full flex items-center gap-3 p-3 rounded transition ${currentPage === 'audit' ? 'bg-blue-600' : 'hover:bg-gray-800'}">
                                ${icons.shield}
                                ${sidebarOpen ? '<span>Audit Log</span>' : ''}
                            </button>
                        ` : ''}
                    </nav>

                    <div class="p-4 border-t border-gray-700">
                        <div class="${sidebarOpen ? '' : 'hidden'}">
                            <p class="text-sm text-gray-400">${currentUser?.role}</p>
                            <p class="text-sm font-medium truncate">${currentUser?.name}</p>
                        </div>
                        <button onclick="handleLogout()" class="mt-2 w-full bg-red-600 hover:bg-red-700 py-2 rounded text-sm transition">
                            ${sidebarOpen ? 'Logout' : '↪'}
                        </button>
                    </div>
                </div>
            `;
        }

        function renderDashboard() {
            return `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-800">Dashboard</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="text-blue-600">${icons.users}</div>
                            </div>
                            <h3 class="text-3xl font-bold text-gray-800 mb-2">248</h3>
                            <p class="text-gray-600">Total Pasien Aktif</p>
                            <p class="text-sm text-blue-600 mt-2">12 pasien baru hari ini</p>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="text-green-600">${icons.fileText}</div>
                            </div>
                            <h3 class="text-3xl font-bold text-gray-800 mb-2">156</h3>
                            <p class="text-gray-600">Resep Aktif</p>
                            <p class="text-sm text-green-600 mt-2">23 resep baru hari ini</p>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="text-red-600">${icons.alertTriangle}</div>
                            </div>
                            <h3 class="text-3xl font-bold text-gray-800 mb-2">3</h3>
                            <p class="text-gray-600">Alert Aktif</p>
                            <p class="text-sm text-red-600 mt-2">Perlu perhatian segera</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Fitur Keamanan Sistem</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="p-4 bg-blue-50 rounded-lg">
                                <h4 class="font-medium text-blue-800 mb-2">Drug Interaction Check</h4>
                                <p class="text-sm text-blue-700">Deteksi otomatis interaksi obat berbahaya</p>
                            </div>
                            <div class="p-4 bg-green-50 rounded-lg">
                                <h4 class="font-medium text-green-800 mb-2">Allergy Alert</h4>
                                <p class="text-sm text-green-700">Peringatan alergi pasien real-time</p>
                            </div>
                            <div class="p-4 bg-purple-50 rounded-lg">
                                <h4 class="font-medium text-purple-800 mb-2">RBAC Access Control</h4>
                                <p class="text-sm text-purple-700">Kontrol akses berbasis role pengguna</p>
                            </div>
                            <div class="p-4 bg-yellow-50 rounded-lg">
                                <h4 class="font-medium text-yellow-800 mb-2">Audit Trail</h4>
                                <p class="text-sm text-yellow-700">Pencatatan lengkap semua aktivitas sistem</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPatientsPage() {
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-gray-800">Data Pasien</h2>
                        <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
                            ${icons.plus}
                            <span>Tambah Pasien</span>
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        ${patients.map(patient => `
                            <div class="bg-white rounded-lg shadow hover:shadow-lg transition">
                                <div class="p-6">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <h3 class="text-xl font-semibold text-gray-800">${patient.name}</h3>
                                            <p class="text-sm text-gray-600">MRN: ${patient.mrn}</p>
                                            <p class="text-sm text-gray-600">Usia: ${patient.age} tahun</p>
                                        </div>
                                        <button onclick="selectPatient('${patient.id}')" class="p-2 hover:bg-blue-50 rounded-full transition">
                                            ${icons.eye}
                                        </button>
                                    </div>

                                    <div class="mb-3">
                                        <p class="text-sm font-medium text-gray-700 mb-1">Alergi:</p>
                                        <div class="flex flex-wrap gap-2">
                                            ${patient.allergies.map(allergy => `
                                                <span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded">${allergy}</span>
                                            `).join('')}
                                        </div>
                                    </div>

                                    <div>
                                        <p class="text-sm font-medium text-gray-700 mb-1">Kondisi:</p>
                                        <div class="flex flex-wrap gap-2">
                                            ${patient.conditions.map(condition => `
                                                <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">${condition}</span>
                                            `).join('')}
                                        </div>
                                    </div>

                                    <div class="mt-4 pt-4 border-t border-gray-200">
                                        <p class="text-sm text-gray-600">
                                            ${patient.activeMedications.length} obat aktif
                                        </p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderPatientDetail() {
            const patient = state.selectedPatient;
            if (!patient) return '<div>Pasien tidak ditemukan</div>';

            return `
                <div class="space-y-6">
                    <div class="flex items-center gap-4">
                        <button onclick="setPage('patients')" class="text-blue-600 hover:text-blue-700">
                            ← Kembali
                        </button>
                        <h2 class="text-2xl font-bold text-gray-800">Detail Pasien</h2>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h3 class="text-2xl font-bold text-gray-800">${patient.name}</h3>
                                <p class="text-gray-600">MRN: ${patient.mrn}</p>
                                <p class="text-gray-600">Usia: ${patient.age} tahun</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="p-4 bg-red-50 rounded-lg">
                                <h4 class="font-semibold text-red-800 mb-2 flex items-center gap-2">
                                    ${icons.alertTriangle}
                                    Alergi
                                </h4>
                                <ul class="space-y-1">
                                    ${patient.allergies.map(allergy => `
                                        <li class="text-red-700">${allergy}</li>
                                    `).join('')}
                                </ul>
                            </div>

                            <div class="p-4 bg-blue-50 rounded-lg">
                                <h4 class="font-semibold text-blue-800 mb-2">Kondisi Medis</h4>
                                <ul class="space-y-1">
                                    ${patient.conditions.map(condition => `
                                        <li class="text-blue-700">${condition}</li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="text-lg font-semibold text-gray-800">Obat Aktif</h4>
                                ${state.currentUser?.role === 'Dokter' ? `
                                    <button onclick="setPage('new-prescription')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center gap-2 text-sm">
                                        ${icons.plus}
                                        <span>Resep Baru</span>
                                    </button>
                                ` : ''}
                            </div>

                            <div class="space-y-3">
                                ${patient.activeMedications.map(med => `
                                    <div class="p-4 border border-gray-200 rounded-lg">
                                        <div class="flex justify-between items-start">
                                            <div class="flex-1">
                                                <h5 class="font-semibold text-gray-800">${med.name}</h5>
                                                <div class="mt-2 grid grid-cols-2 gap-2 text-sm">
                                                    <div>
                                                        <span class="text-gray-600">Dosis:</span>
                                                        <span class="font-medium text-gray-800"> ${med.dose}</span>
                                                    </div>
                                                    <div>
                                                        <span class="text-gray-600">Frekuensi:</span>
                                                        <span class="font-medium text-gray-800"> ${med.frequency}</span>
                                                    </div>
                                                    <div>
                                                        <span class="text-gray-600">Rute:</span>
                                                        <span class="font-medium text-gray-800"> ${med.route}</span>
                                                    </div>
                                                    <div>
                                                        <span class="text-gray-600">Diresepkan:</span>
                                                        <span class="font-medium text-gray-800"> ${med.date}</span>
                                                    </div>
                                                </div>
                                                <p class="text-sm text-gray-500 mt-2">Oleh: ${med.prescribedBy}</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderNewPrescription() {
            const patient = state.selectedPatient;
            if (!patient) return '<div>Pasien tidak ditemukan</div>';

            return `
                <div class="space-y-6">
                    <div class="flex items-center gap-4">
                        <button onclick="setPage('patient-detail')" class="text-blue-600 hover:text-blue-700">
                            ← Kembali
                        </button>
                        <h2 class="text-2xl font-bold text-gray-800">Resep Baru untuk ${patient.name}</h2>
                    </div>

                    ${state.showAlert ? `
                        <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                            <div class="flex items-center gap-3">
                                <div class="text-red-600">${icons.alertTriangle}</div>
                                <div>
                                    <h3 class="font-semibold text-red-800">Peringatan Keamanan!</h3>
                                    <p class="text-red-700">${state.alertType}</p>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <div class="bg-white rounded-lg shadow p-6">
                        <form onsubmit="handlePrescriptionSubmit(event)">
                            <div class="space-y-4">
                                <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <h4 class="font-semibold text-yellow-800 mb-2 flex items-center gap-2">
                                        ${icons.alertTriangle}
                                        Alergi Pasien
                                    </h4>
                                    <p class="text-yellow-700">${patient.allergies.join(', ')}</p>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Obat *</label>
                                    <select onchange="updateFormData('medication', this.value); checkDrugInteraction(this.value); render();" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                        <option value="">Pilih obat...</option>
                                        <option value="Metformin">Metformin</option>
                                        <option value="Amlodipine">Amlodipine</option>
                                        <option value="Lisinopril">Lisinopril</option>
                                        <option value="Warfarin">Warfarin</option>
                                        <option value="Amoxicillin">Amoxicillin</option>
                                        <option value="Paracetamol">Paracetamol</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Dosis *</label>
                                    <input type="text" onchange="updateFormData('dose', this.value)" placeholder="Contoh: 500mg, 10ml" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required />
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Frekuensi *</label>
                                    <select onchange="updateFormData('frequency', this.value)" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                        <option value="">Pilih frekuensi...</option>
                                        <option value="1x sehari">1x sehari</option>
                                        <option value="2x sehari">2x sehari</option>
                                        <option value="3x sehari">3x sehari</option>
                                        <option value="Sesuai kebutuhan">Sesuai kebutuhan</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Rute Pemberian *</label>
                                    <select onchange="updateFormData('route', this.value)" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                        <option value="Oral">Oral</option>
                                        <option value="Intravena (IV)">Intravena (IV)</option>
                                        <option value="Intramuskular (IM)">Intramuskular (IM)</option>
                                        <option value="Subkutan (SC)">Subkutan (SC)</option>
                                        <option value="Topikal">Topikal</option>
                                        <option value="Inhalasi">Inhalasi</option>
                                    </select>
                                </div>

                                <div class="flex gap-3 pt-4">
                                    <button type="submit" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition font-medium">
                                        Simpan Resep
                                    </button>
                                    <button type="button" onclick="setPage('patient-detail')" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                                        Batal
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        function renderAdministration() {
            return `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-800">Instruksi Pemberian Obat</h2>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        ${patients.map(patient => `
                            <div class="bg-white rounded-lg shadow">
                                <div class="p-4 bg-gray-50 border-b border-gray-200">
                                    <h3 class="font-semibold text-gray-800">${patient.name}</h3>
                                    <p class="text-sm text-gray-600">MRN: ${patient.mrn}</p>
                                </div>
                                <div class="p-4 space-y-3">
                                    ${patient.activeMedications.map(med => `
                                        <div class="p-3 border-l-4 border-green-500 bg-green-50 rounded">
                                            <div class="flex justify-between items-start mb-2">
                                                <h4 class="font-semibold text-gray-800">${med.name}</h4>
                                                <button class="p-1 hover:bg-green-100 rounded">
                                                    ${icons.check}
                                                </button>
                                            </div>
                                            <div class="text-sm space-y-1">
                                                <p class="text-gray-700">
                                                    <span class="font-medium">Dosis:</span> ${med.dose}
                                                </p>
                                                <p class="text-gray-700">
                                                    <span class="font-medium">Frekuensi:</span> ${med.frequency}
                                                </p>
                                                <p class="text-gray-700">
                                                    <span class="font-medium">Rute:</span> ${med.route}
                                                </p>
                                            </div>
                                            <div class="mt-3">
                                                <button class="w-full bg-green-600 text-white py-2 rounded text-sm hover:bg-green-700 transition">
                                                    Tandai Sudah Diberikan
                                                </button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderAuditLog() {
            return `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-800">Audit Log Sistem</h2>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 border-b border-gray-200">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Timestamp
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            User
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Aksi
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Detail
                                        </th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${auditLogs.map(log => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                ${log.timestamp}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                ${log.user}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                ${log.action}
                                            </td>
                                            <td class="px-6 py-4 text-sm text-gray-500">
                                                ${log.detail}
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="font-semibold text-blue-800 mb-2">Informasi Audit</h3>
                        <ul class="text-sm text-blue-700 space-y-1">
                            <li>✓ Semua aktivitas dicatat secara otomatis</li>
                            <li>✓ Log tidak dapat diubah atau dihapus</li>
                            <li>✓ Mendukung integritas data dan keamanan sistem</li>
                            <li>✓ Sesuai dengan standar FHIR AuditEvent</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            
            if (!state.currentUser) {
                app.innerHTML = renderLoginPage();
                return;
            }

            let content = '';
            switch(state.currentPage) {
                case 'dashboard':
                    content = renderDashboard();
                    break;
                case 'patients':
                    content = renderPatientsPage();
                    break;
                case 'patient-detail':
                    content = renderPatientDetail();
                    break;
                case 'new-prescription':
                    content = renderNewPrescription();
                    break;
                case 'administration':
                    content = renderAdministration();
                    break;
                case 'audit':
                    content = renderAuditLog();
                    break;
                default:
                    content = renderDashboard();
            }

            app.innerHTML = `
                <div class="flex h-screen bg-gray-100">
                    ${renderSidebar()}
                    <div class="flex-1 overflow-auto">
                        <div class="p-8">
                            ${content}
                        </div>
                    </div>
                </div>
            `;
        }

        // Initial render
        render();
    </script>
</body>
</html>
`;
